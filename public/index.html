<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dragonbound Clone</title>
</head>
<body style="background:#222;color:white;text-align:center">

<h2>Dragonbound Clone</h2>
<p id="turno"></p>

<input id="angle" type="range" min="0" max="180" value="45">
<input id="power" type="range" min="10" max="100" value="50">
<button onclick="shoot()">Disparar</button>

<canvas id="game" width="800" height="400" style="background:#87CEEB"></canvas>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const c = document.getElementById("game");
const ctx = c.getContext("2d");

let players={}, turn=null, proj=null;

socket.on("state", d=>{
  players=d.players; turn=d.turn;
  turno.innerText = turn===socket.id ? "TU TURNO" : "ESPERA";
});

socket.on("projectile", d=>{
  const p=players[d.from];
  const a=d.angle*Math.PI/180;
  proj={x:p.x,y:p.y,vx:Math.cos(a)*d.power/5,vy:-Math.sin(a)*d.power/5};
});

function shoot(){
  if(turn!==socket.id) return;
  socket.emit("shoot",{angle:angle.value,power:power.value});
}

function loop(){
  ctx.clearRect(0,0,800,400);
  ctx.fillStyle="green"; ctx.fillRect(0,350,800,50);
  Object.values(players).forEach(p=>{
    ctx.beginPath();ctx.arc(p.x,p.y,15,0,7);ctx.fill();
  });
  if(proj){
    proj.vy+=0.4; proj.x+=proj.vx; proj.y+=proj.vy;
    ctx.beginPath();ctx.arc(proj.x,proj.y,5,0,7);ctx.fill();
    if(proj.y>350) proj=null;
  }
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
